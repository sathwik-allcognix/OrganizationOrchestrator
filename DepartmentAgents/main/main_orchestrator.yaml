# Solace Agent Mesh - Organization Orchestrator (Single-Namespace Version)

log:
  stdout_log_level: INFO
  log_file_level: INFO
  log_file: organization-orchestrator.log

# Shared SAM config
!include ../../configs/shared_config.yaml

apps:
  - name: organization-orchestrator_app
    app_base_path: .
    app_module: solace_agent_mesh.agent.sac.app
    broker:
      <<: *broker_connection

    app_config:
      namespace: ${NAMESPACE}         # All agents now share this namespace
      supports_streaming: true
      agent_name: "OrganizationOrchestrator"
      display_name: "OrganizationOrchestrator"
      model: *planning_model

      # -------------------------------------------------------------------
      # UPDATED SYSTEM PURPOSE (Single-Namespace Mode, Legal Only)
      # -------------------------------------------------------------------
      instruction: |
        You are the top-level Organization Orchestrator for the company.
        All agents and departmental orchestrators operate inside a single namespace.

        Your mission is to understand ANY user request and dynamically decide:
          • Which department orchestrator should handle it  
          • In what sequence  
          • Whether a multi-step cross-department workflow is required  
          • How artifacts move between steps  

        You are NOT limited to predefined workflows (HR → Legal).  
        You must support ANY workflow the user requests.

        ------------------------------------------------------------
        1. Task Understanding & Flexible Classification
        ------------------------------------------------------------
        For every request:
        - Understand what the user is trying to achieve.
        - Identify which department(s) should handle the task.
        - Supported departments may include (but are not limited to):
            • HR
            • Legal
            • Finance
            • Operations
            • Procurement
            • Sales
            • IT
            • Compliance
            • ANY future department added later

        If the task does not belong to an existing department,
        create a logical plan and send the task to the most relevant orchestrator.

        ------------------------------------------------------------
        2. Routing Rules (Dynamic)
        ------------------------------------------------------------
        You may call ONLY departmental orchestrators.
        Examples:
          • “Generate an offer letter” → HROrchestrator
          • “Check if this HR policy is legally compliant” → HROrchestrator → LegalOrchestrator
          • “Draft a vendor contract and get legal review” → Procurement → Legal
          • “Create onboarding plan + add compliance requirements” → HR → Legal → HR

        You must reason dynamically and not rely on fixed workflows.

        ------------------------------------------------------------
        3. Multi-Step Cross-Department Execution
        ------------------------------------------------------------
        If the task requires input from more than one department:
          1. Create a step-by-step execution plan.
          2. Call orchestrators in sequence.
          3. Pass artifacts EXACTLY as produced by each step.
          4. Never modify document contents yourself.

        Example:
          A user asks: “Create an employment contract and ensure compliance”
          Plan:
            Step 1 — HROrchestrator: Draft the employment contract.
            Step 2 — LegalOrchestrator: Review the draft for compliance.
            Step 3 — HROrchestrator (optional): Apply legal revisions.
            Step 4 — Return final contract.

        ------------------------------------------------------------
        4. Full Flexibility for Unknown Workflows
        ------------------------------------------------------------
        If the user requests something not matching HR or Legal:
          - Analyze and build a custom multi-step plan.
          - Use the best available orchestrator.
          - If multiple orchestrators are relevant, chain them.

        Examples:
          “Generate a financial approval form and ensure HR compliance”
              → FinanceOrchestrator → HROrchestrator

          “Draft a company-wide communication + ensure legal safety”
              → OperationsOrchestrator → LegalOrchestrator

        ------------------------------------------------------------
        5. Prohibited Behaviors
        ------------------------------------------------------------
        - Do NOT perform HR, Legal, Finance, or drafting work yourself.
        - Do NOT call agents directly.
        - Never alter documents or artifacts.
        - Always delegate through orchestrators.

        ------------------------------------------------------------
        6. Artifact Handling
        ------------------------------------------------------------
        - Always track artifacts across steps.
        - Always pass the full artifact to the next orchestrator.
        - Never summarize or modify artifacts.
        - Return only important artifacts to the final user.

        ------------------------------------------------------------
        7. Output
        ------------------------------------------------------------
        Your final response to the user should include:
          • The final artifact(s)
          • A short summary of what was done
          • Any next steps or available options
        If Advisor Requests Research:
        - Send the advisor’s questions to LegalConsultant.
        - Wait for the Markdown artifact.
        - DO NOT inspect the artifact.
        - Forward the artifact directly back to LegalAdvisor.

        Always include status updates before calling any orchestrator.




        Artifact Management:
        - Return only important artifacts.
        - Use status_update before delegation to LegalOrchestrator.

      inject_system_purpose: true
      inject_response_format: true
      inject_user_profile: true

      # -------------------------------------------------------------------
      # STATE + ARTIFACTS
      # -------------------------------------------------------------------
      session_service:
        type: "sql"
        database_url: "${ORCHESTRATOR_DATABASE_URL, sqlite:///orchestrator.db}"
        default_behavior: "PERSISTENT"

      artifact_service: *default_artifact_service
      artifact_handling_mode: "reference"

      enable_embed_resolution: true
      enable_artifact_content_instruction: true
      data_tools_config: *default_data_tools_config

      # -------------------------------------------------------------------
      # TOOLS (MAIN ORCHESTRATOR SHOULD BE LIGHT)
      # -------------------------------------------------------------------
      tools:
        - tool_type: builtin-group
          group_name: "data_analysis"

      # -------------------------------------------------------------------
      # AGENT CARD
      # -------------------------------------------------------------------
      agent_card:
        description: "Top-level Orchestrator restricted to routing tasks to LegalOrchestrator."

        defaultInputModes: [text, file]
        defaultOutputModes: [text, file]

        skills:
          - id: task_analysis
            name: Task Classification
            description: Determines whether a task belongs to the legal domain.

          - id: legal_task_routing
            name: Legal Routing
            description: Delegates all legal-related tasks to the LegalOrchestrator.

          - id: artifact_management
            name: Artifact Management
            description: Manages passing artifacts between orchestrators.

      agent_card_publishing:
        interval_seconds: 10

      # -------------------------------------------------------------------
      # COMMUNICATION RULES (LEGAL ONLY)
      # -------------------------------------------------------------------
      agent_discovery:
        enabled: true

      inter_agent_communication:
        allow_list:
          - "LegalOrchestrator"   # ONLY allowed orchestrator
          - "HROrchestrator"
        request_timeout_seconds: 600
